"use strict";DND.isTouchDevice=Modernizr.touch,DND.clickEvent="click",DND.enterEvent=DND.isTouchDevice?"touchmove":"mouseenter",DND.leaveEvent=DND.isTouchDevice?"touchend":"mouseleave",DND.inputEvent="oninput"in document.createElement("INPUT")?"input":"keyup",_.templateSettings.variable="rc",$(function(){DND.CONST={RESP:{XXS:480,XS:768,SM:992,MD:1200},RESP_NAMES:["xxs","xs","sm","md","lg"],MESSAGES:{ERROR_DEFAULT:"Приносим свои извинения. На сайте проводятся технические работы. Пожалуйста, повторите попытку позже.",FOLDERS:{AFTER_CREATE:"Чтобы перенести презентацию в другую папку, перетащите её мышью на название папки.",AFTER_MOVE:"Объект успешно перемещен в папку",INFOLDER:"Перемещаемый объект уже находится в выбранной папке."}},KEY:{ESCAPE:27,ENTER:13}},DND.tmpl=function(){var t={},e={},o=$(".template-other");return t.getTmpl=function(t){var e={};return t.each(function(t,o){var n=$(this);e[n.attr("id")]=_.template(n.html())}),e},e.init=function(){},e.other=t.getTmpl(o),e}(),DND.tmpl.init()}),$(function(){DND.visual=function(){var t={},e={},o=($(document),$(window)),n=$("body"),i="";return t.resize=function(){o.on("load resize",function(){t.setResp()})},t.setResp=function(){var t=o.width();n.removeClass("b-page__lg b-page__md b-page__sm b-page__xs b-page__xxs"),t>=DND.CONST.RESP.MD?(n.addClass("b-page__lg"),i="lg"):t>=DND.CONST.RESP.SM?(n.addClass("b-page__md"),i="md"):t>=DND.CONST.RESP.XS?(n.addClass("b-page__sm"),i="sm"):t>DND.CONST.RESP.XXS?(n.addClass("b-page__xs"),i="xs"):(n.addClass("b-page__xxs"),i="xxs")},t.svgIco=function(){Modernizr.svg&&svg4everybody({polyfill:!0})},e.init=function(){t.resize(),t.svgIco()},e.currentResp=function(){return t.setResp(),i},e}(),DND.visual.init()}),$(function(){DND.alert=function(){var t={},e=$("body"),o=($(window),null);return t.init=function(){},t.show=function(t){var n;return $("#alert-notify").remove(),e.append(DND.tmpl.other.tmpl__alert({text:t.text})),n=$("#alert-notify"),n.stop().removeAttr("style").show(),clearTimeout(o),o=setTimeout(function(){n.stop().fadeOut(1e3,function(){n.remove()})},t.time||2e3),n},t}(),DND.alert.init()}),$(function(){DND.category=function(){var t,e={},o={},n=($(document),$(window)),i=($("body"),$(".b-category-list")),s=i.find(".b-category-list__ul"),r=$(".b-footer"),a=!1;return e.toggle=function(t){var e;e=i.find(".b-category-list__all"),e.on(DND.clickEvent,function(t){$(this);t.preventDefault(),i.toggleClass("b-category-list__open"),s.slideToggle(400,function(){})})},e.applyScroll=function(t){a||(i.addClass("nano").nanoScroller({preventPageScrolling:!0}),a=!0)},e.destroyScroll=function(){a&&(i.nanoScroller({destroy:!0}),i.removeClass("nano"),a=!1)},e.setMenuHeight=function(){var o,a;o=r.offset().top-t.offset().top,a=n.height(),o>a&&(o=a),o-=20,s.height()>=o?(i.height(o),e.applyScroll(o)):(i.css({height:"auto"}),e.destroyScroll())},e.setParentHeight=function(){var e,o=n.height();e=s.height(),e>o&&(e=o),t.height(e)},e.setMenuPosition=function(e){var o,s,a=n.scrollTop(),l=r.offset().top;a>e-10?(o=t.width(),i.addClass("b-category-list--fixed").css({width:o}),s=a+t.height(),s+20>l?i.css({marginTop:l-s-20}):i.css({marginTop:0})):i.removeClass("b-category-list--fixed").css({width:"auto",marginTop:0})},e.stick=function(){var o;t=i.parent(),o=i.offset().top,n.on("resize",function(){var n=DND.visual.currentResp();"xs"===n||"xxs"===n?(e.destroyScroll(),i.removeClass("b-category-list--fixed").removeAttr("style"),t.removeAttr("style")):(o=t.offset().top,e.setParentHeight(),e.setMenuHeight())}),n.on("load folder.create",function(){var t=DND.visual.currentResp();"xs"===t||"xxs"===t||(e.setParentHeight(),e.setMenuHeight(),e.setMenuPosition(o))}),n.on("scroll",function(t){var n=DND.visual.currentResp();"xs"===n||"xxs"===n||(e.setParentHeight(),e.setMenuPosition(o))})},o.init=function(){i.length&&(e.toggle(),i.hasClass("b-category-list--stick")&&e.stick())},o.getActive=function(){var t,e=i.find(".b-category-list__active a");return t=e.length?{href:e.eq(0).attr("href"),text:e.eq(0).text()}:!1},o}(),DND.category.init()}),$(function(){DND.lkFolders=function(){var t,e={},o={},n=($(document),$("body")),i=$(window),s="b-folders",r=$("."+s),a=$(".b-photos__item");return e.testDropZone=function(t){var e,o;return o=t.closest("."+s+"__item"),e=o.length?o:!1},e.moveEvents=function(){n.on("mousedown touchstart",".b-photos__item .b-photos__link",function(o){var a,l,c=$(this),u=c.data("id"),d={},f=(new Date).getTime(),p=!1,D=function(){n.addClass("drag"),n.append('<div id="drag-drop" class="b-photos__touch">'+c.find(".b-photos__media").html()+"</div>"),a=$("#drag-drop"),a.css({left:d.x+2,top:d.y+i.scrollTop()+2}),c.one("mouseup touchend click tap",function(t){t.preventDefault()}),p=!0};t=r.find("."+s+"__item"),o.preventDefault(),d.x=o.clientX,d.y=o.clientY,n.on("mousemove touchmove",function(o){var n,r={},c=o.originalEvent.touches;l=$(o.target),(new Date).getTime()<f+10||(r.x=o.clientX,r.y=o.clientY,p||D(),void 0!==c&&(r.x=c[0].clientX,r.y=c[0].clientY,l=$(document.elementFromPoint(r.x,r.y))),a.css({left:r.x+2,top:r.y+i.scrollTop()+2}),n=e.testDropZone(l),n?(t.removeClass(s+"__item--drop"),n.addClass(s+"__item--drop")):t.removeClass(s+"__item--drop"))}),n.one("mouseup touchend",function(o){var i,d=$(o.target),f=0,D="",v=null,g=o.originalEvent.changedTouches;return n.off("mousemove touchmove"),p?(o.preventDefault(),o.stopPropagation(),n.removeClass("drag"),a&&a.remove(),void 0!==g&&(d=l),i=e.testDropZone(d),i&&(f=i.data("id"),D=i.find(".b-category-list__val").text(),0===f&&(f=""),v=r.data("folderCurrent"),v===f?DND.alert.show({text:DND.CONST.MESSAGES.FOLDERS.INFOLDER,time:2e3}):$.ajax({type:"POST",url:r.data("folderMove"),data:{folder_id:f,offer_id:u},dataType:"json",beforeSend:function(){c.parent().append('<div class="b-photos__load"></div>')}}).done(function(t){var e,o,i;r.find("."+s+"__list").html(DND.tmpl.other["tmpl__folders-list"]({folders:t,current:v})),o=t[0].cnt_offers>0?"("+t[0].cnt_offers+")":"",r.find("."+s+"__parent .b-category-list__count").text(o),e=c.closest(".b-photos__item"),e.hide(500,function(){e.remove(),n.trigger("folder.move")}),i=DND.alert.show({text:DND.CONST.MESSAGES.FOLDERS.AFTER_MOVE+" &laquo;"+D+"&raquo;.",time:2e3})}).fail(function(){c.parent().find(".b-photos__load").fadeOut(300),DND.alert.show({text:DND.CONST.MESSAGES.ERROR_DEFAULT,time:2e3})})),t.removeClass(s+"__item--drop"),!1):void 0})})},o.init=function(){r.length&&a.length>0&&e.moveEvents()},o}(),DND.lkFolders.init()});